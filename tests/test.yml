---

- hosts: all
  gather_facts: false
  tasks:
    - name: 'ensure python2 is present'
      raw: 'which python || apt-get install -y python python-simplejson'
      changed_when: false

- hosts: all
  remote_user: root
  vars:
    vault_repo_password: 'foobar'
    restic_jobs:
      - [ '0 4  * * *', 'backup /var' ]
      - [ '0 6  * * *', 'backup /usr' ]

  roles:
    - ansible-restic
  
  tasks:
    - name: run `restic version`
      command: restic version
      register: cmd_restic_version

    - name: ensure versions match
      assert:
        that:
          - "restic_version in cmd_restic_version.stdout"
        msg: 'restic version does not match to that in restic_version'
